---
title: "Assignment 3"
author: "Bob Koenig"
date: "2/22/2022"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
```

1) Subset the data to only include observations on red wines. Describe the distribution of the response.
Based on the nature of the response variable, _what type of regression model would you suggest starting
with (and why)?_


```{r}
wine <- read.csv("wine.csv") %>% filter(type == 'red')

dim(wine)
```

2) Explore the data using summary statistics and graphics. Do any of the variables appear to have an
association with the overall quality score? If so, which? Describe the nature of these associations.

```{r}
table(wine$quality)
```
```{r}
hist(wine$quality)

```
```{r}
summary(wine)
```

```{r}
pairs(wine[,0:12])
```

```{r}
plot (quality~. , data = wine)
```

3) Construct a binary response according to the following rule
Y =
{1, quality >= 7
 0, quality < 7 }

Fit a logistic regression to the data using all possible main effects (i.e., include each variable, but no
interaction effects). Assess the performance of this model. Does the model seem well-calibrated? Discuss
and provide a plot of a calibration curve.


```{r}
wine %>% 
  mutate(Y = ifelse(quality>=7,1,0)) -> wine

model <- glm(Y ~ fixed.acidity + volatile.acidity + citric.acid + residual.sugar + chlorides + free.sulfur.dioxide +
               total.sulfur.dioxide + density + pH + sulphates + alcohol , data = wine, family = binomial)

summary(model)
```

Assess the performance of this model. Does the model seem well-calibrated? Discuss
and provide a plot of a calibration curve

```{r}
prob <- predict(model, type = "response")

rms::val.prob(prob, y = wine$Y)
```

Brier Score of 0.084


4) Interpret the effect of the predictor alcohol on the odds that quality >= 7. Construct an effect plot
visualizing the effect of alcohol on the probability that quality >= 7 and describe the relationship.
Does this plot look linear or nonlinear? If nonlinear, discuss how this is possible.

?? for each increase in 1% alcohol the log odds of the wine being a high quality wine goes up by 0.75

```{r}
# Effect plot
plotmo::plotmo(model)
```
Appears to be a direct relationship that is non-linear.

??? how is this possible ?????

5) Discuss reasons why the modeling approach used in 3) is ill-advised for modeling these data

This technique involves setting a fixed cutoff level that divides the good wines from the poor wines, in this case the level is set to 7.  This is inflexible and does not allow for adjustments to be made by the reader.



6) Fit an ordinal regression model to the data using the original response (i.e., quality) using the orm()
function from R package rms. Construct an effect plot for each predictor showing the effect on the
predicted probability that quality >= 7. From these, try to determine the top three predictors solely
in terms of their effect on the predicted probability that quality >= 7.

```{r}
o_model <- rms::orm(quality ~ fixed.acidity + volatile.acidity + citric.acid + residual.sugar + chlorides +
                    free.sulfur.dioxide + total.sulfur.dioxide + density + pH + sulphates + alcohol 
                    , data = wine)

o_model
```

Effect plot
--Error--

```{r}
plotmo::plotmo(o_model)
```

7) Consider an observation x0(i.e., a single red wine) with the following characteristics:

## fixed.acidity 7.3000
## volatile.acidity 0.6500
## citric.acid 0.0000
## residual.sugar 1.2000
## chlorides 0.0650
## free.sulfur.dioxide 15.0000
## total.sulfur.dioxide 21.0000
## density 0.9946
## pH 3.3900
## sulphates 0.4700
## alcohol 10.0000

Based on your fitted model from 6), provide estimates for the following quantities:
•P r (quality == 7|x −0)
•P r (quality >= 7|x0)
•P r (quality == 9|x0)
•P r (quality >= 9|x0)

```{r}

```
8) You’re asked to use your model from part 6) to provide predictions for the white wines included in the
original data. Discuss whether or not you think this is a reasonable request and why. What would you
do in practice (e.g., what if this was your boss asking)?

```{r}

```

